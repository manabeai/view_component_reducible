<div class="min-h-screen bg-stone-50 text-stone-900 antialiased">
  <header class="sticky top-0 z-10 border-b border-stone-200 bg-white/80 backdrop-blur-md">
    <div class="mx-auto max-w-5xl px-6 py-4">
      <h1 class="text-xl font-serif font-bold tracking-tight text-stone-800">Salon de Beaute</h1>
    </div>
  </header>

  <main class="mx-auto max-w-5xl px-6 py-8">
    <div class="flex flex-col gap-8 lg:flex-row lg:items-start">
      <div class="flex-1 space-y-8">
        <section class="relative rounded-3xl border border-stone-200 bg-white p-6 shadow-sm md:p-8">
          <div class="mb-6 flex items-start justify-between gap-4">
            <div class="flex items-center gap-3">
              <div class="flex h-10 w-10 items-center justify-center rounded-full bg-amber-50 text-amber-700">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
              </div>
              <div>
                <h2 class="text-lg font-bold">ご希望の日程</h2>
                <p class="text-xs text-stone-500">ご来店日を選択してください</p>
              </div>
            </div>
            <div class="flex h-8 w-8 items-center justify-center rounded-full text-xs font-bold <%= vcr_state.selected_day ? "bg-amber-500 text-white" : "border border-amber-500 text-amber-500" %>">
              1
            </div>
          </div>
          <div class="pointer-events-none absolute right-[46px] top-full h-8 w-1 <%= vcr_state.selected_day ? "bg-amber-300" : "bg-stone-200" %>"></div>

          <div class="grid grid-cols-4 gap-2 sm:grid-cols-7">
            <% calendar_day_records.each do |day_info| %>
              <% day = day_info.day %>
              <%= vcr_button_to(
                day,
                state: vcr_state_token,
                msg_type: :select_day,
                msg_payload: { day: day },
                button_attrs: {
                  data: { testid: "day-#{day}" },
                  disabled: calendar_day_disabled?(day_info.status),
                  class: calendar_day_button_class(day, day_info.status)
                }
              ) do %>
                <span class="text-[10px] text-stone-500"><%= day_info.date %> (<%= day_info.weekday %>)</span>
                <span class="text-base font-bold"><%= day %></span>
                <span class="text-[11px] <%= calendar_status_class(day_info.status) %>"><%= calendar_status_label(day_info.status) %></span>
              <% end %>
            <% end %>
          </div>
        </section>

        <section class="relative rounded-3xl border border-stone-200 bg-white p-6 shadow-sm md:p-8">
          <div class="mb-6 flex items-start justify-between gap-4">
            <div class="flex items-center gap-3">
              <div class="flex h-10 w-10 items-center justify-center rounded-full bg-amber-50 text-amber-700">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
              </div>
              <div>
                <h2 class="text-lg font-bold">ご希望の時間</h2>
                <p class="text-xs text-stone-500">Day <%= vcr_state.selected_day %></p>
              </div>
            </div>
            <div class="flex h-8 w-8 items-center justify-center rounded-full text-xs font-bold <%= vcr_state.selected_time ? "bg-amber-500 text-white" : "border border-amber-500 text-amber-500" %>">
              2
            </div>
          </div>
          <div class="pointer-events-none absolute right-[46px] top-full h-8 w-1 <%= vcr_state.selected_time ? "bg-amber-300" : "bg-stone-200" %>"></div>

          <% if vcr_state.selected_day %>
            <div class="grid grid-cols-3 gap-3 sm:grid-cols-4 md:grid-cols-5">
              <% Array(vcr_state.available_times).each do |time_label| %>
                <%= vcr_button_to(
                  time_label,
                  state: vcr_state_token,
                  msg_type: :select_time,
                  msg_payload: { time: time_label },
                  button_attrs: {
                    data: { testid: "time-#{time_label}" },
                    class: "rounded-xl border px-4 py-3 text-sm font-semibold #{vcr_state.selected_time == time_label ? "border-amber-500 bg-white text-amber-800 shadow" : "border-stone-200 bg-white text-stone-700 hover:border-amber-300"}"
                  }
                ) %>
              <% end %>
            </div>
          <% else %>
            <div class="rounded-xl border border-dashed border-stone-200 bg-stone-50 p-4 text-xs text-stone-500" data-testid="time-hint">
              先に日程を選択してください
            </div>
          <% end %>
        </section>

        <section class="rounded-3xl border border-stone-200 bg-white p-6 shadow-sm md:p-8" data-testid="staff-list">
          <div class="mb-6 flex items-start justify-between gap-4">
            <div class="flex items-center gap-3">
              <div class="flex h-10 w-10 items-center justify-center rounded-full bg-amber-50 text-amber-700">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
              </div>
              <div>
                <h2 class="text-lg font-bold">担当スタッフ</h2>
                <p class="text-xs text-stone-500">Time <%= vcr_state.selected_time %></p>
              </div>
            </div>
            <div class="flex h-8 w-8 items-center justify-center rounded-full text-xs font-bold <%= vcr_state.selected_staff ? "bg-amber-500 text-white" : "border border-amber-500 text-amber-500" %>">
              3
            </div>
          </div>

          <% if vcr_state.selected_time %>
            <div class="grid gap-4 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3">
              <% Array(vcr_state.available_staff).each do |staff| %>
                <%= vcr_button_to(
                  staff,
                  state: vcr_state_token,
                  msg_type: :select_staff,
                  msg_payload: { staff: staff },
                  button_attrs: {
                    data: { testid: "staff-#{staff.downcase}" },
                    aria: { pressed: vcr_state.selected_staff == staff },
                    class: "rounded-xl border px-4 py-3 text-sm font-semibold #{vcr_state.selected_staff == staff ? "border-amber-500 bg-amber-50 text-amber-800" : "border-stone-200 bg-white text-stone-700 hover:border-amber-300"}"
                  }
                ) %>
              <% end %>
            </div>
          <% else %>
            <div class="rounded-xl border border-dashed border-stone-200 bg-stone-50 p-4 text-xs text-stone-500" data-testid="staff-hint">
              先に時間を選択してください
            </div>
          <% end %>
        </section>
      </div>

      <aside class="sticky top-24 w-full lg:w-80" data-testid="booking-summary">
        <div class="rounded-3xl border border-stone-200 bg-white p-6 shadow-lg">
          <h2 class="border-b border-stone-100 pb-3 text-sm font-bold uppercase tracking-wider text-stone-500">ご予約内容の確認</h2>

          <dl class="mt-6 space-y-6">
            <div class="flex items-start justify-between">
              <dt class="text-xs font-medium text-stone-400">ご来店予定日</dt>
              <dd class="text-right text-sm font-bold <%= summary_class(vcr_state.selected_day) %>" data-testid="selected-day"><%= calendar_day_summary(vcr_state.selected_day) %></dd>
            </div>
            <div class="flex items-start justify-between">
              <dt class="text-xs font-medium text-stone-400">お時間</dt>
              <dd class="text-right text-sm font-bold <%= summary_class(vcr_state.selected_time) %>" data-testid="selected-time"><%= summary_label(vcr_state.selected_time) %></dd>
            </div>
            <div class="flex items-start justify-between">
              <dt class="text-xs font-medium text-stone-400">担当者</dt>
              <dd class="text-right text-sm font-bold <%= summary_class(vcr_state.selected_staff) %>" data-testid="selected-staff"><%= summary_label(vcr_state.selected_staff) %></dd>
            </div>
          </dl>

          <div class="mt-8 space-y-3">
            <div class="rounded-xl bg-stone-50 p-4">
              <div class="flex gap-2 text-[11px] italic text-stone-500">
                <svg class="shrink-0 text-amber-600" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                <span>キャンセルは前日までにお願いいたします。当日キャンセルはキャンセル料が発生する場合がございます。</span>
              </div>
            </div>

            <% if vcr_state.selected_staff %>
              <button
                type="button"
                data-testid="booking-button"
                class="flex w-full items-center justify-center gap-2 rounded-xl bg-stone-800 py-4 font-bold text-white shadow-md transition-all hover:bg-stone-700">
                予約を確定する
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
              </button>
            <% end %>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="mt-12 border-t border-stone-200 bg-stone-100 py-10 text-center">
    <p class="text-xs text-stone-400">© 2024 Salon de Beaute Inc. All rights reserved.</p>
  </footer>
</div>
